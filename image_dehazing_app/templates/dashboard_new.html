{% extends "base.html" %}

{% block title %}Dashboard - DeHaze AI{% endblock %}

{% block content %}
<!-- Welcome Section -->
<section class="welcome-section">
    <div class="welcome-container">
        <div class="welcome-content">
            <div class="welcome-header">
                <h2>Welcome back, {{ session.username }}!</h2>
                <p>Transform your hazy images into crystal-clear masterpieces with our advanced AI dehazing technology.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">99%</div>
                        <div class="stat-label">Accuracy Rate</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">4K</div>
                        <div class="stat-label">Resolution Support</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number"><5s</div>
                        <div class="stat-label">Processing Time</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Dashboard -->
<div class="dashboard-container">
    <!-- Model Selection -->
    <section class="model-selection-section">
        <div class="section-header">
            <h2>Choose Your AI Model</h2>
            <p>Select the perfect dehazing algorithm for your image</p>
        </div>

        <div class="model-grid">
            <div class="model-card" data-model="simple">
                <div class="model-header">
                    <div class="model-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="model-badge">Fast</div>
                </div>
                <div class="model-content">
                    <h3>SimpleDehazeNet</h3>
                    <p>Quick and efficient basic dehazing for everyday use</p>
                </div>
                <div class="model-features">
                    <span class="feature">‚ö° Fast Processing</span>
                    <span class="feature">üéØ Good Quality</span>
                </div>
            </div>

            <div class="model-card" data-model="aod">
                <div class="model-header">
                    <div class="model-icon">
                        <i class="fas fa-crosshairs"></i>
                    </div>
                    <div class="model-badge">Balanced</div>
                </div>
                <div class="model-content">
                    <h3>AOD-Net</h3>
                    <p>All-in-One Dehazing Network with optimal performance</p>
                </div>
                <div class="model-features">
                    <span class="feature">‚öñÔ∏è Balanced</span>
                    <span class="feature">üé® High Quality</span>
                </div>
            </div>

            <div class="model-card" data-model="ffa">
                <div class="model-header">
                    <div class="model-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="model-badge">Advanced</div>
                </div>
                <div class="model-content">
                    <h3>FFA-Net</h3>
                    <p>Feature Fusion Attention Network for superior results</p>
                </div>
                <div class="model-features">
                    <span class="feature">üöÄ Advanced</span>
                    <span class="feature">‚≠ê Best Quality</span>
                </div>
            </div>

            <div class="model-card" data-model="dehazeformer">
                <div class="model-header">
                    <div class="model-icon">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <div class="model-badge">Cutting-edge</div>
                </div>
                <div class="model-content">
                    <h3>DehazeFormer</h3>
                    <p>Transformer-based architecture for state-of-the-art dehazing</p>
                </div>
                <div class="model-features">
                    <span class="feature">üî¨ Research Grade</span>
                    <span class="feature">üèÜ Premium</span>
                </div>
            </div>

            <div class="model-card" data-model="uformer">
                <div class="model-header">
                    <div class="model-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="model-badge">Professional</div>
                </div>
                <div class="model-content">
                    <h3>Uformer</h3>
                    <p>U-Net with Transformers for professional-grade enhancement</p>
                </div>
                <div class="model-features">
                    <span class="feature">üéØ Professional</span>
                    <span class="feature">üíé Studio Quality</span>
                </div>
            </div>

            <div class="model-card" data-model="traditional">
                <div class="model-header">
                    <div class="model-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <div class="model-badge">Reliable</div>
                </div>
                <div class="model-content">
                    <h3>Traditional Method</h3>
                    <p>Classic dark channel prior algorithm for consistent results</p>
                </div>
                <div class="model-features">
                    <span class="feature">üîí Reliable</span>
                    <span class="feature">üìà Predictable</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Upload Section -->
    <section class="upload-section">
        <div class="section-header">
            <h2>Upload Your Image</h2>
            <p>Drag and drop or browse to select your hazy image</p>
        </div>

        <div class="upload-container">
            <form method="POST" enctype="multipart/form-data" id="upload-form">
                <div class="upload-area" id="upload-area">
                    <div class="upload-content">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">
                            <h3>Drop your image here</h3>
                            <p>or <span class="upload-link">browse files</span></p>
                            <p class="upload-hint">Supports PNG, JPG, JPEG up to 50MB</p>
                        </div>
                        <input type="file" id="file" name="file" accept=".png,.jpg,.jpeg" required style="display: none;">
                    </div>
                </div>

                <div class="upload-options">
                    <div class="option-group">
                        <label class="option-toggle">
                            <input type="checkbox" name="show_steps" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Show Processing Steps</span>
                        </label>
                    </div>

                    <div class="option-group">
                        <label class="option-toggle">
                            <input type="checkbox" name="high_quality" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Maximum Quality</span>
                        </label>
                    </div>
                </div>

                <div class="selected-model-info">
                    <div class="model-display">
                        <span class="model-label">Selected Model:</span>
                        <span class="model-name" id="selected-model-text">SimpleDehazeNet</span>
                        <input type="hidden" id="selected-model" name="model" value="simple">
                    </div>
                </div>

                <button type="submit" class="btn-primary" id="dehaze-btn">
                    <span class="btn-icon">
                        <i class="fas fa-magic"></i>
                    </span>
                    <span class="btn-text">Start AI Dehazing</span>
                    <span class="btn-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        Processing...
                    </span>
                </button>
            </form>
        </div>
    </section>

    <!-- Results Section -->
    {% if input_image %}
    <section class="image-comparison-container">
        <div class="comparison-header">
            <h3>Dehazing Results</h3>
            <p>Your image has been successfully processed</p>
        </div>

        <div class="image-comparison">
            <div class="result-card original">
                <div class="result-header">
                    <div class="result-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="result-info">
                        <h3>Original Image</h3>
                        <p>Hazy input</p>
                    </div>
                </div>
                <div class="result-image">
                    <img src="{{ url_for('static', filename='uploads/' + input_image) }}" alt="Original Image">
                </div>
            </div>

            <div class="result-arrow">
                <div class="arrow-container">
                    <i class="fas fa-arrow-right"></i>
                    <span>AI Processing</span>
                </div>
            </div>

            <div class="result-card dehazed">
                <div class="result-header">
                    <div class="result-icon">
                        <i class="fas fa-sparkles"></i>
                    </div>
                    <div class="result-info">
                        <h3>Dehazed Image</h3>
                        <p>Enhanced output</p>
                    </div>
                </div>
                <div class="result-image">
                    <img src="{{ url_for('static', filename='outputs/' + output_image) }}" alt="Dehazed Image">
                </div>
                <div class="image-actions">
                    <a href="{{ url_for('download', filename=output_image) }}" class="download-btn">
                        <i class="fas fa-download"></i>
                        Download Result
                    </a>
                </div>
            </div>
        </div>

        {% if steps %}
        <div class="processing-steps">
            <h3>Processing Steps</h3>
            <div class="steps-grid">
                {% for step_key, step_filename in steps.items() %}
                <div class="step-item">
                    <div class="step-image">
                        {% if step_key == 'step1' %}
                        <img src="{{ url_for('static', filename='uploads/' + step_filename) }}" alt="{{ step_key }}">
                        {% else %}
                        <img src="{{ url_for('static', filename='outputs/' + step_filename) }}" alt="{{ step_key }}">
                        {% endif %}
                    </div>
                    <div class="step-label">
                        <span>{{ step_key.replace('_', ' ').title() }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </section>
    {% endif %}
</div>

<script>
// Model Selection
document.querySelectorAll('.model-card').forEach(card => {
    card.addEventListener('click', function() {
        document.querySelectorAll('.model-card').forEach(c => c.classList.remove('selected'));
        this.classList.add('selected');

        const model = this.dataset.model;
        const modelName = this.querySelector('h3').textContent;
        document.getElementById('selected-model').value = model;
        document.getElementById('selected-model-text').textContent = modelName;
    });
});

// File Upload Handling
const uploadArea = document.getElementById('upload-area');
const fileInput = document.getElementById('file');
const uploadText = uploadArea.querySelector('.upload-text h3');

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');

    const files = e.dataTransfer.files;
    if (files.length > 0) {
        fileInput.files = files;
        updateUploadDisplay(files[0]);
    }
});

uploadArea.addEventListener('click', () => {
    fileInput.click();
});

fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        updateUploadDisplay(e.target.files[0]);
    }
});

function updateUploadDisplay(file) {
    uploadText.innerHTML = `Selected: <strong>${file.name}</strong>`;
    uploadArea.classList.add('has-file');
}

// Form Submission
document.getElementById('upload-form').addEventListener('submit', function(e) {
    const btn = document.getElementById('dehaze-btn');
    const btnText = btn.querySelector('.btn-text');
    const btnLoading = btn.querySelector('.btn-loading');

    btnText.style.display = 'none';
    btnLoading.style.display = 'inline-flex';
    btn.disabled = true;

    setTimeout(() => {
        btnText.style.display = 'inline-flex';
        btnLoading.style.display = 'none';
        btn.disabled = false;
    }, 30000);
});

// Notification Close
document.querySelectorAll('.notification-close').forEach(btn => {
    btn.addEventListener('click', function() {
        this.closest('.notification').remove();
    });
});

// Initialize first model as selected
document.querySelector('.model-card').classList.add('selected');
</script>
{% endblock %}
